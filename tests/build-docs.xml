<project name="piwik" default="all" basedir=".">

	<property file="build.properties" />
	<property file="defaults.properties" />

	<target name="phpdoc">
		<echo>phpDocumentor started</echo>

		<delete dir="${basedir}/documentation"/>
		<mkdir dir="${basedir}/documentation"/>

		<copy file="${workspace.home}/misc/phpdoc-config.ini" tofile="${basedir}/phpdoc-config.ini">
			<filterset>
				<filter token="target = documentation" value="target = ${basedir}/documentation"/>
			</filterset>
		</copy>

		<exec executable="${php.executable}" dir="${workspace.home}/" failonerror="true" failifexecutionfails="true">
			<arg value="${phpdocumentor.home}/phpDocumentor/phpdoc.inc" />
			<arg value="--useconfig"/>
			<arg file="${basedir}/phpdoc-config.ini"/>
		</exec>

		<echo>phpDocumentor finished</echo>		
	</target>

	<target name="schemaspy">
		<echo>SchemaSpy started</echo>

		<delete dir="${basedir}/schemaspy-report"/>
		<mkdir dir="${basedir}/schemaspy-report"/>

		<java jar="${workspace.home}/tests/lib/java/schemaSpy_3.1.1.jar" fork="true" failonerror="true" maxmemory="256m" dir="${workspace.home}">
			<arg value="-t"/>
			<arg value="mysql"/>
			<arg value="-host"/>
			<arg value="${database.main.host}:${database.main.port}"/>
			<arg value="-db"/>
			<arg value="${database.main.name}"/>
			<arg value="-cp"/>
			<arg path="${workspace.home}/tests/lib/java/mysql-connector-java-5.1.7.jar"/>
			<arg value="-u"/>
			<arg value="${database.main.username}"/>
			<arg value="-o"/>
			<arg path="${basedir}/schemaspy-report"/>
			<arg value="-p"/>
			<arg value="${database.main.password}"/>
		</java>

		<echo>SchemaSpy finished</echo>
	</target>

	<target name="all">
		<antcall target="phpdoc"/>
		<antcall target="schemaspy"/>
	</target>

</project>
